(function(r,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(r=typeof globalThis<"u"?globalThis:r||self,i(r["anything-gpt"]={}))})(this,function(r){"use strict";const i=t=>t!=null&&t.body?t:Promise.reject(t),f=t=>[t==null?void 0:t.status,t==null?void 0:t.statusCode].some(a=>a===200)?t:Promise.reject(t),o={model:"gpt-3.5-turbo",temperature:.7,max_tokens:4e3,stream:!0},h={api_key:"",markdown:!1},s=t=>({gpt:{...o,...t==null?void 0:t.gpt},instance:{...h,...t==null?void 0:t.instance}});async function m(t=s(),a,...e){if(!t.instance.api_key){console.error("ERROR: ChatGPT API KEY is undefined.");return}const u=Array.from(a).map((c,d)=>{const n=e[d];return c+(n instanceof Object?JSON.stringify(n):n||"")}).join("");return this.state.push({role:"user",content:u}),await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t.instance.api_key}`,"Content-Type":"application/json"},body:JSON.stringify({...t.gpt,messages:this.state})}).then(i).then(f).then(async c=>t.gpt.stream?this.stream(c):this.text(c)).catch(c=>this.error(c))}const y=t=>({state:t.state||[],storage:t.storage||new Map,text:async a=>{var e;return(e=t==null?void 0:t.text)==null?void 0:e.call(t,a)},stream:async a=>{var e;return(e=t==null?void 0:t.stream)==null?void 0:e.call(t,a)},error:async a=>{var e;return(e=t==null?void 0:t.error)==null?void 0:e.call(t,a)}}),g=(t,a)=>{const e=t.body.getReader();return e.read().then(async function u({done:c,value:d}){return c?a("",!0):(String.fromCharCode(...d).replace(/"content":"([^"]*)"/g,(n,l)=>(a(l.replace(/\\n/g,`
`),!1),n)),e.read().then(u))})};r.chunkify=g,r.core=m,r.useEnvironment=y,r.useOptions=s,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
