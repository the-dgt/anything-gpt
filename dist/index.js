(function(r,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(r=typeof globalThis<"u"?globalThis:r||self,n(r["anything-gpt"]={}))})(this,function(r){"use strict";const n=t=>t!=null&&t.body?t:Promise.reject(t),f=t=>[t==null?void 0:t.status,t==null?void 0:t.statusCode].some(e=>e===200)?t:Promise.reject(t),h={model:"gpt-3.5-turbo",temperature:.7,max_tokens:4e3,stream:!0},m={api_key:"",markdown:!1},d=t=>({gpt:{...h,...t==null?void 0:t.gpt},instance:{...m,...t==null?void 0:t.instance}});async function y(t=d(),e,...a){if(!t.instance.api_key){console.error("ERROR: ChatGPT API KEY is undefined.");return}const u=Array.from(e).map((c,o)=>{const i=a[o];return c+(i instanceof Object?JSON.stringify(i):i||"")}).join("");return this.state.push({role:"user",content:u}),await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t.instance.api_key}`,"Content-Type":"application/json"},body:JSON.stringify({...t.gpt,messages:this.state})}).then(n).then(f).then(async c=>t.gpt.stream?this.stream(c):this.text(c)).catch(c=>this.error(c))}const g=t=>({state:t.state||[],storage:t.storage||new Map,text:async e=>{var a;return(a=t==null?void 0:t.text)==null?void 0:a.call(t,e)},stream:async e=>{var a;return(a=t==null?void 0:t.stream)==null?void 0:a.call(t,e)},error:async e=>{var a;return(a=t==null?void 0:t.error)==null?void 0:a.call(t,e)}}),l=t=>TextDecoder?new TextDecoder().decode(t,{stream:!0}):String.fromCharCode(...t),O=t=>{try{return JSON.parse(`["${t}"]`)[0]||t}catch{return t}},b=(t,e)=>{const a=t.body.getReader();return a.read().then(async function u({done:c,value:o}){if(c)return e("",!0);const i=/"content":\s*"((\\.|[^"])*)"/gm;for await(const s of l(o).matchAll(i))s[1]&&await e(O(s[1]));return a.read().then(u)})};r.chunkify=b,r.core=y,r.useEnvironment=g,r.useOptions=d,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
