(function(n,c){typeof exports=="object"&&typeof module<"u"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(n=typeof globalThis<"u"?globalThis:n||self,c(n["anything-gpt"]={}))})(this,function(n){"use strict";const c=t=>t!=null&&t.body?t:Promise.reject(t),h=t=>[t==null?void 0:t.status,t==null?void 0:t.statusCode].some(e=>e===200)?t:Promise.reject(t),f={model:"gpt-3.5-turbo",temperature:.7,max_tokens:4e3,stream:!0},m={api_key:"",markdown:!1},s=t=>({gpt:{...f,...t==null?void 0:t.gpt},instance:{...m,...t==null?void 0:t.instance}});async function y(t=s(),e,...a){if(!t.instance.api_key)throw new Error("ERROR: ChatGPT API KEY is undefined.");const u=Array.from(e).map((r,o)=>{const i=a[o];return r+(i instanceof Object?JSON.stringify(i):i||"")}).join("");return this.state.push({role:"user",content:u}),await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t.instance.api_key}`,"Content-Type":"application/json"},body:JSON.stringify({...t.gpt,messages:this.state})}).then(c).then(h).then(async r=>t.gpt.stream?this.stream(r):this.text(r)).catch(r=>this.error(r))}const l=t=>({state:t.state||[],storage:t.storage||new Map,text:async function(e){var a;return(a=t==null?void 0:t.text)==null?void 0:a.call(this,e)},stream:async function(e){var a;return(a=t==null?void 0:t.stream)==null?void 0:a.call(this,e)},error:async function(e){var a;return(a=t==null?void 0:t.error)==null?void 0:a.call(this,e)}}),g=t=>TextDecoder?new TextDecoder().decode(t,{stream:!0}):String.fromCharCode(...t),O=t=>{try{return JSON.parse(`["${t}"]`)[0]||t}catch{return t}},b=(t,e)=>{const a=t.body.getReader();return a.read().then(async function u({done:r,value:o}){if(r)return e("",!0);const i=/"content":\s*"((\\.|[^"])*)"/gm;for await(const d of g(o).matchAll(i))d[1]&&await e(O(d[1]));return a.read().then(u)})};n.chunkify=b,n.core=y,n.useEnvironment=l,n.useOptions=s,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
